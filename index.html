<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NFT AR Test</title>
<style>
body { margin:0; overflow:hidden; background:#000; font-family:Arial,sans-serif; }
#status { position:absolute; top:10px; left:50%; transform:translateX(-50%); color:#fff; background:rgba(0,0,0,0.6); padding:6px 10px; border-radius:6px; z-index:10; }
button { position:absolute; bottom:20px; left:50%; transform:translateX(-50%); padding:10px 16px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>
<div id="status">Waiting to start...</div>
<button id="startBtn">Start AR</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/three.js/build/ar-nft.js"></script>

<script>
const status = document.getElementById('status');
const startBtn = document.getElementById('startBtn');

startBtn.addEventListener('click', async () => {
    startBtn.style.display='none';
    status.textContent='Requesting camera permission...';

    const NFT_BASE = 'old'; // base name of NFT files
    const REPLACEMENT_IMAGE = 'new.jpg'; // image to spawn

    // Three.js scene
    const scene = new THREE.Scene();
    const camera = new THREE.Camera();
    scene.add(camera);

    const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.domElement.style.position='absolute';
    renderer.domElement.style.top='0px';
    renderer.domElement.style.left='0px';
    document.body.appendChild(renderer.domElement);

    // AR.js source
    const arSource = new THREEx.ArToolkitSource({sourceType:'webcam'});
    await new Promise(r => arSource.init(r));

    window.addEventListener('resize', () => {
        arSource.onResizeElement();
        arSource.copyElementSizeTo(renderer.domElement);
    });

    // AR.js context
    const arContext = new THREEx.ArToolkitContext({
        cameraParametersUrl:'https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/three.js/data/camera_para.dat',
        detectionMode:'mono'
    });

    arContext.init(() => {
        camera.projectionMatrix.copy(arContext.getProjectionMatrix());
        status.textContent='AR initialized. Point at your NFT marker.';
    });

    // Marker root
    const markerRoot = new THREE.Group();
    scene.add(markerRoot);

    // NFT controls
    new THREEx.ArNftControls(arContext, markerRoot, NFT_BASE, {changeMatrixMode:'modelViewMatrix'});

    // Replacement poster
    const loader = new THREE.TextureLoader();
    const texture = loader.load(REPLACEMENT_IMAGE);
    const geometry = new THREE.PlaneGeometry(1,1);
    const material = new THREE.MeshBasicMaterial({map:texture, side:THREE.DoubleSide});
    const posterMesh = new THREE.Mesh(geometry, material);
    markerRoot.add(posterMesh);

    // Render loop
    function animate(){
        requestAnimationFrame(animate);
        if(arSource.ready) arContext.update(arSource.domElement);
        renderer.render(scene, camera);
    }
    animate();
});
</script>
</body>
</html>
