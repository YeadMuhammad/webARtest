<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AR.js Marker Debug</title>

  <style>
    html, body { margin:0; height:100%; background:#000; overflow:hidden; }
    #status { position:fixed; top:10px; left:10px; color:#0f0; font-family:monospace; background:rgba(0,0,0,0.5); padding:10px; border-radius:8px; z-index:100; }
    #startBtn { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); padding:10px 20px; font-size:16px; border:none; border-radius:8px; background:#1e88e5; color:#fff; cursor:pointer; z-index:100; }
  </style>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <!-- AR.js for A-Frame -->
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.2/aframe/build/aframe-ar.min.js"></script>
  <!-- THREEx ArToolkit (required for THREEx namespace) -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/three.js/build/ar-threex.js"></script>
</head>

<body>
<div id="status">Press "Start AR" to begin</div>
<button id="startBtn">Start AR</button>

<script>
const statusEl = document.getElementById('status');
const startBtn = document.getElementById('startBtn');

let arSource, arContext, scene, camera, markerRoot;

startBtn.addEventListener('click', () => {
    startBtn.disabled = true;
    statusEl.textContent = "Requesting camera access...";
    initAR();
});

function initAR() {
    // Create A-Frame scene
    scene = document.createElement('a-scene');
    scene.setAttribute('embedded','');
    scene.setAttribute('vr-mode-ui','enabled: false');
    scene.setAttribute('arjs','trackingMethod: best; sourceType: webcam; debugUIEnabled: true;');
    document.body.appendChild(scene);

    camera = document.createElement('a-entity');
    camera.setAttribute('camera','');
    scene.appendChild(camera);

    // Marker root
    markerRoot = document.createElement('a-marker');
    markerRoot.setAttribute('type','pattern');
    markerRoot.setAttribute('url','patternqr.patt'); // Put your pattern here
    markerRoot.setAttribute('emitevents','true');
    scene.appendChild(markerRoot);

    const box = document.createElement('a-box');
    box.setAttribute('position','0 0.125 0');
    box.setAttribute('rotation','0 45 0');
    box.setAttribute('color','#4CC9F0');
    box.setAttribute('shadow','true');
    markerRoot.appendChild(box);

    // THREEx ArToolkitSource
    arSource = new THREEx.ArToolkitSource({ sourceType: 'webcam' });
    arSource.init(() => {
        console.log('‚úÖ arSource initialized');
        statusEl.textContent = "Camera ready. Point at your QR marker.";
        onResize();
    });

    window.addEventListener('resize', () => onResize());

    // THREEx ArToolkitContext
    arContext = new THREEx.ArToolkitContext({
        cameraParametersUrl: 'https://rawcdn.githack.com/AR-js-org/AR.js/master/aframe/data/camera_para.dat',

        detectionMode: 'mono',
        debug: true
    });

    arContext.init(() => {
        console.log('‚úÖ arContext initialized');
        camera.object3D.projectionMatrix.copy(arContext.getProjectionMatrix());
    });

    // Marker events
    markerRoot.addEventListener('markerFound', () => {
        console.log('üéØ Marker detected!');
        statusEl.textContent = "Marker detected ‚úÖ";
    });
    markerRoot.addEventListener('markerLost', () => {
        console.log('‚ùå Marker lost');
        statusEl.textContent = "Marker lost ‚ùå";
    });

    // Render loop
    const render = function() {
        requestAnimationFrame(render);
        if(arSource.ready === false) return;
        arContext.update(arSource.domElement);
    };
    render();
}

function onResize(){
    if(arSource && arSource.domElement){
        arSource.onResizeElement();
        arSource.copyElementSizeTo(scene);
        if(arContext && arContext.arController){
            arSource.copyElementSizeTo(arContext.arController.canvas);
        }
    }
}
</script>
</body>
</html>
